# /etc/chrony/chrony.conf
# NTP server backed by HTTPS time sync.
#
# No upstream NTP peers are configured. The system clock is
# synchronized externally via HTTPS Date headers (see entrypoint.sh)
# and chrony serves it to LAN clients as a stratum-3 source.

# Serve the local system clock at stratum 3.
# "orphan" prevents clients from seeing this server as authoritative
# when multiple local servers exist — only the one with the lowest
# address wins, avoiding split-brain.
local stratum 3 orphan

# Allow NTP clients from anywhere.
# Restrict access via Docker network or firewall as needed.
allow all

# Listen on all interfaces.
port 123
bindaddress 0.0.0.0

# Track clock drift rate between restarts.
driftfile /var/lib/chrony/drift

# Allow the clock to be stepped (not just slewed) if the offset
# exceeds 0.5s. The -1 means unlimited steps — necessary because
# the HTTPS sync loop may introduce periodic jumps.
makestep 0.5 -1

# Logging
logdir /var/log/chrony
log tracking measurements statistics
