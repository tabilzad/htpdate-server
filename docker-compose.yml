services:
  htpdate-server:
    build:
      context: .
    # Set your registry/repo here for `docker compose push`
    image: ${REGISTRY:-docker.io}/${IMAGE_NAME:-ntp-over-https}:${TAG:-latest}
    container_name: htpdate-server
    restart: unless-stopped

    # SYS_TIME is required so the container can adjust the system clock
    # from HTTPS time sources.
    cap_add:
      - SYS_TIME

    ports:
      - "123:123/udp"

    volumes:
      - htpdate-drift:/var/lib/htpdate

    environment:
      # Space-separated list of HTTPS servers to fetch time from.
      - HTTPS_SERVERS=www.google.com www.cloudflare.com www.apple.com www.microsoft.com
      # htpdate adaptive polling bounds (seconds).
      - MIN_POLL=900
      - MAX_POLL=3600
      - TZ=UTC

volumes:
  htpdate-drift:
